# MMSA é€šç”¨è®­ç»ƒæµ‹è¯•æŒ‡å—

## ðŸ“‹ æ¦‚è¿°

`train.py` æ˜¯ä¸€ä¸ªé€šç”¨çš„è®­ç»ƒå’Œæµ‹è¯•è„šæœ¬ï¼Œæ”¯æŒé…ç½®ä»»æ„æ¨¡åž‹å’Œæ•°æ®é›†è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ã€‚

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨ TFN æ¨¡åž‹è®­ç»ƒ copa_1231 æ•°æ®é›†
python train.py -m tfn -d copa_1231

# ä½¿ç”¨ LMF æ¨¡åž‹è®­ç»ƒ MOSI æ•°æ®é›†
python train.py -m lmf -d mosi

# ä½¿ç”¨å¤šä¸ªéšæœºç§å­
python train.py -m tfn -d copa_1231 -s 1111 1112 1113
```

---

## ðŸ“ æ”¯æŒçš„æ¨¡åž‹

æ‰€æœ‰ `singleTask` ç›®å½•ä¸‹çš„æ¨¡åž‹ï¼š

- `tfn` - Tensor Fusion Network
- `lmf` - Low-rank Multimodal Fusion
- `mfn` - Memory Fusion Network
- `graph_mfn` - Graph Memory Fusion Network
- `ef_lstm` - Early Fusion LSTM
- `lf_dnn` - Late Fusion DNN
- `mult` - Multimodal Transformer
- `misa` - Modality-Invariant and -Specific Representations
- `bert_mag` - BERT Multimodal Adaptation Gate
- `mfm` - Multimodal Factorization Model
- `mmim` - Multimodal Mutual Information Maximization
- `mctn` - Multimodal Cyclic Translation Network
- `cenet` - Cross-modal Enhancement Network
- `almt` - Adaptive Learning Multimodal Transformer
- `almt_cider` - ALMT with CIDer

---

## ðŸ“Š æ”¯æŒçš„æ•°æ®é›†

- `mosi` - CMU-MOSI
- `mosei` - CMU-MOSEI
- `sims` - CH-SIMS
- `simsv2` - CH-SIMS v2
- `custom` - è‡ªå®šä¹‰æ•°æ®é›†
- `train_12_16` - è®­ç»ƒæ•°æ®é›†
- `copa_1231` - COPA 1231 æ•°æ®é›†

---

## ðŸ”§ å‘½ä»¤è¡Œå‚æ•°

### å¿…éœ€å‚æ•°

- `-m, --model`: æ¨¡åž‹åç§°ï¼ˆä»Žæ”¯æŒçš„æ¨¡åž‹åˆ—è¡¨ä¸­é€‰æ‹©ï¼‰
- `-d, --dataset`: æ•°æ®é›†åç§°ï¼ˆä»Žæ”¯æŒçš„æ•°æ®é›†åˆ—è¡¨ä¸­é€‰æ‹©ï¼‰

### å¯é€‰å‚æ•°

#### è®­ç»ƒé…ç½®

- `-s, --seeds`: éšæœºç§å­åˆ—è¡¨ï¼ˆé»˜è®¤: `[1111]`ï¼‰
  ```bash
  python train.py -m tfn -d copa_1231 -s 1111 1112 1113
  ```

- `--skip-validation`: è·³è¿‡éªŒè¯é›†æµç¨‹ï¼ˆç›´æŽ¥è®­ç»ƒå’Œæµ‹è¯•ï¼‰
  ```bash
  python train.py -m tfn -d copa_1231 --skip-validation
  ```

#### GPU/CPU é…ç½®

- `--gpu-ids`: GPU ID åˆ—è¡¨ï¼ˆé»˜è®¤: è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ç¬¬ä¸€ä¸ªGPUï¼‰
  ```bash
  # ä½¿ç”¨ GPU 0
  python train.py -m tfn -d copa_1231 --gpu-ids 0
  
  # ä½¿ç”¨å¤šä¸ª GPU
  python train.py -m tfn -d copa_1231 --gpu-ids 0 1
  
  # å¼ºåˆ¶ä½¿ç”¨ CPU
  python train.py -m tfn -d copa_1231 --gpu-ids ""
  ```

#### æ•°æ®åŠ è½½é…ç½®

- `--num-workers`: æ•°æ®åŠ è½½å™¨å·¥ä½œè¿›ç¨‹æ•°ï¼ˆé»˜è®¤: GPUæ¨¡å¼4, CPUæ¨¡å¼2ï¼‰
  ```bash
  python train.py -m tfn -d copa_1231 --num-workers 8
  ```

#### è‡ªå®šä¹‰é…ç½®

- `--config`: è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆJSONæ ¼å¼ï¼‰
  ```bash
  python train.py -m tfn -d copa_1231 --config my_config.json
  ```

  é…ç½®æ–‡ä»¶ç¤ºä¾‹ (`config_example.json`):
  ```json
  {
    "batch_size": 16,
    "learning_rate": 0.0005,
    "early_stop": 10,
    "hidden_dims": [128, 32, 128]
  }
  ```

- `--config-file`: MMSA é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆè¦†ç›–é»˜è®¤çš„ config_regression.jsonï¼‰
  ```bash
  python train.py -m tfn -d copa_1231 --config-file custom_config.json
  ```

#### è¾“å‡ºç›®å½•é…ç½®

- `--model-save-dir`: æ¨¡åž‹ä¿å­˜ç›®å½•ï¼ˆé»˜è®¤: `./saved_models`ï¼‰
- `--res-save-dir`: ç»“æžœä¿å­˜ç›®å½•ï¼ˆé»˜è®¤: `./results`ï¼‰
- `--log-dir`: æ—¥å¿—ä¿å­˜ç›®å½•ï¼ˆé»˜è®¤: `./logs`ï¼‰

#### æ—¥å¿—é…ç½®

- `--verbose-level`: æ—¥å¿—è¯¦ç»†ç¨‹åº¦ï¼ˆ0=ERROR, 1=INFO, 2=DEBUGï¼Œé»˜è®¤: 1ï¼‰

#### è¶…å‚æ•°è°ƒä¼˜

- `--tune`: å¯ç”¨è¶…å‚æ•°è°ƒä¼˜æ¨¡å¼
- `--tune-times`: è¶…å‚æ•°è°ƒä¼˜æ¬¡æ•°ï¼ˆé»˜è®¤: 50ï¼‰
  ```bash
  python train.py -m tfn -d copa_1231 --tune --tune-times 100
  ```

---

## ðŸ“– ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: åŸºæœ¬è®­ç»ƒ

```bash
# ä½¿ç”¨ TFN æ¨¡åž‹è®­ç»ƒ copa_1231 æ•°æ®é›†
python train.py -m tfn -d copa_1231
```

### ç¤ºä¾‹ 2: å¤šéšæœºç§å­è®­ç»ƒ

```bash
# ä½¿ç”¨ 3 ä¸ªéšæœºç§å­ï¼Œç»“æžœå–å¹³å‡å€¼
python train.py -m tfn -d copa_1231 -s 1111 1112 1113
```

### ç¤ºä¾‹ 3: è·³è¿‡éªŒè¯é›†

```bash
# ç›´æŽ¥è®­ç»ƒå’Œæµ‹è¯•ï¼Œè·³è¿‡éªŒè¯é›†
python train.py -m tfn -d copa_1231 --skip-validation
```

### ç¤ºä¾‹ 4: ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶ my_config.json
cat > my_config.json << EOF
{
  "batch_size": 16,
  "learning_rate": 0.0005,
  "early_stop": 15
}
EOF

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®è®­ç»ƒ
python train.py -m tfn -d copa_1231 --config my_config.json
```

### ç¤ºä¾‹ 5: CPU è®­ç»ƒ

```bash
# å¼ºåˆ¶ä½¿ç”¨ CPU
python train.py -m tfn -d copa_1231 --gpu-ids ""
```

### ç¤ºä¾‹ 6: å°è¯•ä¸åŒæ¨¡åž‹

```bash
# å°è¯• LMF æ¨¡åž‹
python train.py -m lmf -d copa_1231

# å°è¯• MISA æ¨¡åž‹
python train.py -m misa -d copa_1231

# å°è¯• ALMT æ¨¡åž‹
python train.py -m almt -d copa_1231
```

### ç¤ºä¾‹ 7: è¶…å‚æ•°è°ƒä¼˜

```bash
# è¿›è¡Œ 100 æ¬¡è¶…å‚æ•°è°ƒä¼˜
python train.py -m tfn -d copa_1231 --tune --tune-times 100
```

### ç¤ºä¾‹ 8: å®Œæ•´é…ç½®ç¤ºä¾‹

```bash
python train.py \
  -m tfn \
  -d copa_1231 \
  -s 1111 1112 1113 \
  --gpu-ids 0 \
  --num-workers 4 \
  --skip-validation \
  --config my_config.json \
  --model-save-dir ./my_models \
  --res-save-dir ./my_results \
  --log-dir ./my_logs \
  --verbose-level 2
```

---

## ðŸ“‚ è¾“å‡ºæ–‡ä»¶

è®­ç»ƒå®ŒæˆåŽï¼Œç»“æžœä¿å­˜åœ¨ä»¥ä¸‹ä½ç½®ï¼š

### æ¨¡åž‹æ–‡ä»¶
```
saved_models/{model_name}-{dataset_name}.pth
ä¾‹å¦‚: saved_models/tfn-copa_1231.pth
```

### æµ‹è¯•ç»“æžœ
```
results/normal/{dataset_name}.csv
ä¾‹å¦‚: results/normal/copa_1231.csv
```

åŒ…å«æ‰€æœ‰è¯„ä¼°æŒ‡æ ‡ï¼š
- åŸºç¡€æŒ‡æ ‡ï¼šå‡†ç¡®çŽ‡ã€F1åˆ†æ•°ã€MAEã€ç›¸å…³ç³»æ•°ç­‰
- COPAæŒ‡æ ‡ï¼ˆå¦‚æžœæ•°æ®é›†æ”¯æŒï¼‰ï¼šæ•´ä½“å‡†ç¡®çŽ‡å’Œå„èŒƒå¼å‡†ç¡®çŽ‡

### è®­ç»ƒæ—¥å¿—
```
logs/{model_name}-{dataset_name}.log
ä¾‹å¦‚: logs/tfn-copa_1231.log
```

---

## ðŸ” æŸ¥çœ‹å¸®åŠ©

```bash
python train.py --help
```

ä¼šæ˜¾ç¤ºå®Œæ•´çš„å‚æ•°è¯´æ˜Žå’Œä½¿ç”¨ç¤ºä¾‹ã€‚

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜Ž

### è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ ¼å¼

è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼ˆ`--config`ï¼‰æ˜¯ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œå¯ä»¥è¦†ç›–é»˜è®¤çš„è¶…å‚æ•°ï¼š

```json
{
  "batch_size": 16,
  "learning_rate": 0.0005,
  "early_stop": 10,
  "hidden_dims": [128, 32, 128],
  "text_out": 32,
  "post_fusion_dim": 64,
  "dropouts": [0.3, 0.3, 0.3, 0.5]
}
```

**æ³¨æ„**: ä¸åŒæ¨¡åž‹æ”¯æŒçš„é…ç½®é¡¹å¯èƒ½ä¸åŒï¼Œè¯·å‚è€ƒå„æ¨¡åž‹çš„é…ç½®æ–‡ä»¶ã€‚

### MMSA é…ç½®æ–‡ä»¶

MMSA æ¡†æž¶ä½¿ç”¨ `src/MMSA/config/config_regression.json` ä½œä¸ºé»˜è®¤é…ç½®æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åŒ…å«ï¼š
- æ•°æ®é›†é…ç½®ï¼ˆç‰¹å¾è·¯å¾„ã€åºåˆ—é•¿åº¦ã€ç‰¹å¾ç»´åº¦ç­‰ï¼‰
- æ¨¡åž‹é…ç½®ï¼ˆå„æ¨¡åž‹åœ¨ä¸åŒæ•°æ®é›†ä¸Šçš„è¶…å‚æ•°ï¼‰

å¦‚æžœéœ€è¦ä¿®æ”¹ï¼Œå¯ä»¥ç›´æŽ¥ç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ `--config-file` æŒ‡å®šæ–°çš„é…ç½®æ–‡ä»¶ã€‚

---

## ðŸŽ¯ æœ€ä½³å®žè·µ

### 1. é¦–æ¬¡è®­ç»ƒ

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å¿«é€ŸéªŒè¯
python train.py -m tfn -d copa_1231 -s 1111
```

### 2. æ­£å¼è®­ç»ƒ

```bash
# ä½¿ç”¨å¤šä¸ªéšæœºç§å­ï¼ŒèŽ·å¾—æ›´ç¨³å®šçš„ç»“æžœ
python train.py -m tfn -d copa_1231 -s 1111 1112 1113 1114 1115
```

### 3. æ¨¡åž‹å¯¹æ¯”

```bash
# è®­ç»ƒå¤šä¸ªæ¨¡åž‹è¿›è¡Œå¯¹æ¯”
python train.py -m tfn -d copa_1231
python train.py -m lmf -d copa_1231
python train.py -m misa -d copa_1231
```

### 4. è¶…å‚æ•°è°ƒä¼˜

```bash
# å…ˆè¿›è¡Œè¶…å‚æ•°è°ƒä¼˜ï¼Œæ‰¾åˆ°æœ€ä½³é…ç½®
python train.py -m tfn -d copa_1231 --tune --tune-times 50

# ç„¶åŽä½¿ç”¨æœ€ä½³é…ç½®è¿›è¡Œæ­£å¼è®­ç»ƒ
python train.py -m tfn -d copa_1231 --config best_config.json
```

---

## ðŸ› æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1: æ¨¡åž‹åç§°é”™è¯¯

**é”™è¯¯**: `ValueError: invalid choice: 'xxx'`

**è§£å†³**: æ£€æŸ¥æ¨¡åž‹åç§°æ˜¯å¦æ­£ç¡®ï¼Œä½¿ç”¨ `python train.py --help` æŸ¥çœ‹æ”¯æŒçš„æ¨¡åž‹åˆ—è¡¨ã€‚

### é—®é¢˜ 2: æ•°æ®é›†ä¸å­˜åœ¨

**é”™è¯¯**: `FileNotFoundError: xxx.pkl`

**è§£å†³**: 
- æ£€æŸ¥æ•°æ®é›†æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¡®è®¤æ•°æ®é›†åç§°æ˜¯å¦æ­£ç¡®
- å¯¹äºŽ `copa_1231`ï¼Œç¡®ä¿å·²è¿è¡Œæ•°æ®è½¬æ¢è„šæœ¬

### é—®é¢˜ 3: GPU å†…å­˜ä¸è¶³

**è§£å†³**:
- å‡å° batch_sizeï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼‰
- ä½¿ç”¨ CPU è®­ç»ƒï¼š`--gpu-ids ""`
- å‡å° num_workers

### é—®é¢˜ 4: COPA æŒ‡æ ‡æœªå‡ºçŽ°

**æ£€æŸ¥**:
1. ç¡®è®¤æ•°æ®é›†åç§°ä¸º `copa_1231`
2. æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰ "COPAè¯„ä¼°å¤±è´¥" çš„è­¦å‘Š
3. ç¡®è®¤æµ‹è¯•é›†æ ·æœ¬æ•°èƒ½è¢« 122 æ•´é™¤

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- `è®­ç»ƒæµ‹è¯•æµç¨‹è¯´æ˜Ž.md` - è¯¦ç»†çš„è®­ç»ƒæµ‹è¯•æµç¨‹è¯´æ˜Ž
- `è®­ç»ƒæµ‹è¯•æŒ‡å—.md` - COPA 1231 æ•°æ®é›†ä¸“ç”¨æŒ‡å—
- `src/MMSA/config/config_regression.json` - é»˜è®¤é…ç½®æ–‡ä»¶

---

**æœ€åŽæ›´æ–°**: 2025-01-03

